@page "/tournaments/{TournamentId}"
@inherits ViewTournamentBase

<PageTitle>Tournament: @(_tournament?.Name ?? "Loading...")</PageTitle>

@if (_errorMessage != null)
{
    <MudAlert Severity="Severity.Error" Class="mt-4">
        <MudText Typo="Typo.h6">Error Loading Tournament</MudText>
        <MudText>@_errorMessage</MudText>
    </MudAlert>
}
else if (_tournament == null)
{
    <MudProgressLinear Color="Color.Primary" Indeterminate="true" Class="my-3" />
}
else
{
    <MudText Typo="Typo.h4" Class="mb-4">@_tournament.Name</MudText>

    <MudPaper Class="pa-4 mb-4">
        <MudText Typo="Typo.h6" Class="mb-2">Tournament Details</MudText>
        <MudSimpleTable>
            <tbody>
                <tr>
                    <td><strong>Status:</strong></td>
                    <td>
                        <MudChip T="string" Size="Size.Small" Color="@GetStatusColor(_tournament.Status)">
                            @_tournament.Status
                        </MudChip>
                    </td>
                </tr>
                <tr>
                    <td><strong>Created:</strong></td>
                    <td>@_tournament.CreatedAt.ToString("g")</td>
                </tr>
                <tr>
                    <td><strong>Players:</strong></td>
                    <td>@_tournament.PlayerIds.Count</td>
                </tr>
            </tbody>
        </MudSimpleTable>
    </MudPaper>

    <MudButton Variant="Variant.Filled" Color="Color.Primary" StartIcon="@Icons.Material.Filled.Add" OnClick="@(async () => await ShowAddPlayerDialog())" Class="mb-4">
        Add Player
    </MudButton>

    <MudButton Variant="Variant.Filled" Color="Color.Secondary" StartIcon="@Icons.Material.Filled.PlayArrow" OnClick="GenerateBracket" Class="mb-4 ml-2">
        Generate Bracket
    </MudButton>

    <MudButton Variant="Variant.Outlined" Color="Color.Default" StartIcon="@Icons.Material.Filled.Visibility" OnClick="ViewBracket" Class="mb-4 ml-2">
        View Bracket
    </MudButton>

    @if (_tournament.PlayerIds.Any())
    {
        <MudPaper Class="pa-4 mt-4">
            <MudText Typo="Typo.h6" Class="mb-3">Players (@_tournament.PlayerIds.Count)</MudText>
            <div class="player-list">
                @foreach (var playerId in _tournament.PlayerIds)
                {
                    <div class="player-row">
                        <MudText class="player-name">@GetPlayerName(playerId)</MudText>
                        <MudIconButton Icon="@Icons.Material.Filled.Delete" 
                                       Color="Color.Error" 
                                       Size="Size.Small"
                                       OnClick="@(() => RemovePlayer(playerId))"
                                       Disabled="@_isRemoving" />
                    </div>
                }
            </div>
        </MudPaper>
    }
    else
    {
        <MudAlert Severity="Severity.Info" Class="mt-4">
            No players added to this tournament yet.
        </MudAlert>
    }
}

